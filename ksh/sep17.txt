
getUrlByConfiguration ${CONFIG_FILE_NAME}  # 生成变量 CURL_PATTERN_TEMPLATE（base_url}）
prepareCurlUrl # CURL_PATTERN_TEMPLATE (组装参数)
triggerBatchJob # 请求完整的 url（主要是重试这个请求）


################## 代码如下

#log "URL:${CURL_PATTERN_TEMPLATE}"

# 设置重试参数，默认值为1
RETRY=${8:-1}
ATTEMPT=1
SUCCESS=false

# 重试逻辑
while [ $ATTEMPT -le $RETRY ] && [ "$SUCCESS" = false ]; do
    log "Attempt $ATTEMPT of $RETRY: Triggering Batch Job..."
    triggerBatchJob
   
    if [[ ${RESULT} = "COMPLETED" || ${NEED_RESPONSE} = "N" ]]; then
        SUCCESS=true
        log "Batch Job triggered successfully on attempt $ATTEMPT"
    elif [[ ${RESULT} = "FAILED" ]]; then
        log "Batch Job trigger failed on attempt $ATTEMPT"
        if [ $ATTEMPT -lt $RETRY ]; then
            log "Waiting before next retry..."
            sleep 5  # 可选：添加短暂的等待时间，避免过于频繁的重试
        fi
        ATTEMPT=$((ATTEMPT + 1))
    else
        # 其他结果（既不是COMPLETED也不是FAILED）不重试，直接退出
        SUCCESS=false
        break
    fi
done

log "End Trigger Batch Job ..."
log "******************************************"

if [[ "$SUCCESS" = true ]]; then
    exit 0
else
    exit 1
fi


