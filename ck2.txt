import tkinter as tk
from tkinter import ttk, scrolledtext, messagebox
from tkcalendar import Calendar
import os
from datetime import datetime

# æ—¥å¿—å­˜æ”¾ç›®å½•
LOG_DIR = "logs"
os.makedirs(LOG_DIR, exist_ok=True)

class SimpleLogApp:
    def __init__(self, root):
        self.root = root
        self.root.title("ğŸ“… æˆ‘çš„æ—¥å¿— - ç®€å•ç‰ˆ")
        self.root.geometry("600x500")

        # å½“å‰é€‰ä¸­çš„æ—¥æœŸï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼Œå¦‚ "2024-06-01"ï¼‰
        self.selected_date = None

        # æ—¥å†æ§ä»¶
        self.cal = Calendar(
            root,
            selectmode='day',
            year=datetime.now().year,
            month=datetime.now().month,
            day=datetime.now().day
        )
        self.cal.pack(pady=10, fill="x")

        # ç»‘å®šæ—¥å†é€‰æ‹©äº‹ä»¶
        self.cal.bind("<<CalendarSelected>>", self.on_date_selected)

        # æ—¥å¿—æ˜¾ç¤ºå’Œç¼–è¾‘åŒºåŸŸ
        self.log_text = scrolledtext.ScrolledText(
            root, wrap=tk.WORD, width=70, height=20
        )
        self.log_text.pack(pady=10, padx=10, fill="both", expand=True)

        # ä¿å­˜æŒ‰é’®
        save_btn = ttk.Button(root, text="ğŸ’¾ ä¿å­˜æ—¥å¿—", command=self.save_log)
        save_btn.pack(pady=5)

        # é»˜è®¤åŠ è½½ä»Šå¤©çš„æ—¥å¿—
        today_str = datetime.now().strftime("%Y-%m-%d")
        self.load_log_for_date(today_str)

    def on_date_selected(self, event):
        """å½“ç”¨æˆ·ç‚¹å‡»æ—¥å†ä¸Šçš„æŸå¤©æ—¶è§¦å‘"""
        selected_date_str = self.cal.get_date()  # ğŸ“Œ å·²ç»æ˜¯å­—ç¬¦ä¸²ï¼Œå¦‚ "2024-06-01"
        self.selected_date = selected_date_str
        self.load_log_for_date(selected_date_str)

    def load_log_for_date(self, date_str):
        """åŠ è½½æŒ‡å®šæ—¥æœŸçš„æ—¥å¿—å†…å®¹"""
        self.log_text.delete(1.0, tk.END)  # æ¸…ç©ºç¼–è¾‘åŒº
        log_filename = os.path.join(LOG_DIR, f"log_{date_str}.txt")

        if os.path.exists(log_filename):
            try:
                with open(log_filename, "r", encoding="utf-8") as f:
                    content = f.read()
                    self.log_text.insert(tk.END, content)
            except Exception as e:
                messagebox.showerror("è¯»å–é”™è¯¯", f"æ— æ³•è¯»å–æ—¥å¿—æ–‡ä»¶ï¼š{e}")
        else:
            # å¦‚æœæ²¡æœ‰æ—¥å¿—ï¼Œæ˜¾ç¤ºæç¤ºæ–‡æœ¬
            self.log_text.insert(tk.END, f"ğŸ“ è¿˜æ²¡æœ‰ä¸º {date_str} å†™æ—¥å¿—å“¦ï¼Œå¼€å§‹å†™ç‚¹ä»€ä¹ˆå§ï½")

        # æ›´æ–°çª—å£æ ‡é¢˜æ˜¾ç¤ºå½“å‰æ—¥æœŸ
        self.root.title(f"ğŸ“… æˆ‘çš„æ—¥å¿— - {date_str}")

    def save_log(self):
        """ä¿å­˜å½“å‰ç¼–è¾‘çš„æ—¥å¿—åˆ°æ–‡ä»¶"""
        if not self.selected_date:
            messagebox.showwarning("æœªé€‰æ‹©æ—¥æœŸ", "è¯·å…ˆåœ¨æ—¥å†ä¸­é€‰æ‹©æ—¥æœŸï¼")
            return

        date_str = self.selected_date  # å·²ç»æ˜¯å­—ç¬¦ä¸²ï¼Œå¦‚ "2024-06-01"
        log_content = self.log_text.get(1.0, tk.END + "-1c")  # è·å–æ–‡æœ¬ï¼Œå»æ‰æœ«å°¾æ¢è¡Œ
        log_filename = os.path.join(LOG_DIR, f"log_{date_str}.txt")

        try:
            with open(log_filename, "w", encoding="utf-8") as f:
                f.write(log_content)
            messagebox.showinfo("ä¿å­˜æˆåŠŸ", f"âœ… æ—¥å¿—å·²ä¿å­˜è‡³ï¼š{date_str}")
        except Exception as e:
            messagebox.showerror("ä¿å­˜å¤±è´¥", f"âŒ æ— æ³•ä¿å­˜æ—¥å¿—ï¼š{e}")

if __name__ == "__main__":
    root = tk.Tk()
    app = SimpleLogApp(root)
    root.mainloop()
